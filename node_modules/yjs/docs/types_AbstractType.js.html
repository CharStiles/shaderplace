

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: types/AbstractType.js | yjs</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="./style.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 162px; height: 162px">
        
            <a href="/" rel="noopener noreferrer" target="_blank">
                <img src="https://yjs.dev/images/logo/yjs-512x512.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">yjs</a></h1>
        
            <span class="version">v13.4.11</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
    <div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-encoding.html">encoding</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:encoding_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-encoding.html#.applyUpdate">applyUpdate</a></li><li><a href="module-encoding.html#.applyUpdateV2">applyUpdateV2</a></li><li><a href="module-encoding.html#.decodeStateVector">decodeStateVector</a></li><li><a href="module-encoding.html#.decodeStateVectorV2">decodeStateVectorV2</a></li><li><a href="module-encoding.html#.encodeStateAsUpdate">encodeStateAsUpdate</a></li><li><a href="module-encoding.html#.encodeStateAsUpdateV2">encodeStateAsUpdateV2</a></li><li><a href="module-encoding.html#.encodeStateVector">encodeStateVector</a></li><li><a href="module-encoding.html#.encodeStateVectorV2">encodeStateVectorV2</a></li><li><a href="module-encoding.html#.readStateVector">readStateVector</a></li><li><a href="module-encoding.html#.readUpdate">readUpdate</a></li><li><a href="module-encoding.html#.readUpdateV2">readUpdateV2</a></li><li><a href="module-encoding.html#.writeDocumentStateVector">writeDocumentStateVector</a></li><li><a href="module-encoding.html#.writeStateAsUpdate">writeStateAsUpdate</a></li><li><a href="module-encoding.html#.writeStateVector">writeStateVector</a></li><li><a href="module-encoding.html#~cleanupPendingStructs">cleanupPendingStructs</a></li><li><a href="module-encoding.html#~writeStructs">writeStructs</a></li></ul></div></li><li><a href="module-Y.html">Y</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:Y_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-Y.html#~DocOpts">DocOpts</a></li></ul></div></li><li><a href="module-YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray_sub"></div></li><li><a href="module-YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap_sub"></div></li><li><a href="module-YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.html#.cleanupYTextFormatting">cleanupYTextFormatting</a></li><li><a href="module-YText.html#.parent">parent</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.html#~cleanupContextlessFormattingGap">cleanupContextlessFormattingGap</a></li><li><a href="module-YText.html#~cleanupFormattingGap">cleanupFormattingGap</a></li><li><a href="module-YText.html#~equalAttrs">equalAttrs</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-YText.html#~DeltaItem">DeltaItem</a></li><li><a href="module-YText.html#~TextAttributes">TextAttributes</a></li></ul></div></li><li><a href="module-YXml.html">YXml</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml_sub"><div class="member-type">Typedef</div><ul class="inner"><li><a href="module-YXml.html#~CSS_Selector">CSS_Selector</a></li><li><a href="module-YXml.html#~domFilter">domFilter</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="AbsolutePosition_AbsolutePosition.html">AbsolutePosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbsolutePosition#AbsolutePosition_sub"></div></li><li><a href="AbstractConnector.html">AbstractConnector</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractConnector_sub"></div></li><li><a href="AbstractContent.html">AbstractContent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractContent_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="AbstractContent.html#copy">copy</a></li><li><a href="AbstractContent.html#delete">delete</a></li><li><a href="AbstractContent.html#gc">gc</a></li><li><a href="AbstractContent.html#getContent">getContent</a></li><li><a href="AbstractContent.html#getLength">getLength</a></li><li><a href="AbstractContent.html#getRef">getRef</a></li><li><a href="AbstractContent.html#integrate">integrate</a></li><li><a href="AbstractContent.html#isCountable">isCountable</a></li><li><a href="AbstractContent.html#mergeWith">mergeWith</a></li><li><a href="AbstractContent.html#splice">splice</a></li><li><a href="AbstractContent.html#write">write</a></li></ul></div></li><li><a href="AbstractDSDecoder_AbstractDSDecoder.html">AbstractDSDecoder</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractDSDecoder#AbstractDSDecoder_sub"></div></li><li><a href="AbstractStruct_AbstractStruct.html">AbstractStruct</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractStruct#AbstractStruct_sub"></div></li><li><a href="AbstractType.html">AbstractType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="AbstractType_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="AbstractType.html#_dEH">_dEH</a></li><li><a href="AbstractType.html#_eH">_eH</a></li><li><a href="AbstractType.html#_first">_first</a></li><li><a href="AbstractType.html#_item">_item</a></li><li><a href="AbstractType.html#_map">_map</a></li><li><a href="AbstractType.html#_searchMarker">_searchMarker</a></li><li><a href="AbstractType.html#_start">_start</a></li><li><a href="AbstractType.html#doc">doc</a></li><li><a href="AbstractType.html#parent">parent</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="AbstractType.html#_callObserver">_callObserver</a></li><li><a href="AbstractType.html#_copy">_copy</a></li><li><a href="AbstractType.html#_integrate">_integrate</a></li><li><a href="AbstractType.html#_write">_write</a></li><li><a href="AbstractType.html#clone">clone</a></li><li><a href="AbstractType.html#observe">observe</a></li><li><a href="AbstractType.html#observeDeep">observeDeep</a></li><li><a href="AbstractType.html#toJSON">toJSON</a></li><li><a href="AbstractType.html#unobserve">unobserve</a></li><li><a href="AbstractType.html#unobserveDeep">unobserveDeep</a></li></ul></div></li><li><a href="ArraySearchMarker_ArraySearchMarker.html">ArraySearchMarker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ArraySearchMarker#ArraySearchMarker_sub"></div></li><li><a href="ContentAny_ContentAny.html">ContentAny</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentAny#ContentAny_sub"></div></li><li><a href="ContentBinary_ContentBinary.html">ContentBinary</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentBinary#ContentBinary_sub"></div></li><li><a href="ContentDeleted_ContentDeleted.html">ContentDeleted</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ContentDeleted#ContentDeleted_sub"></div></li><li><a href="DeleteItem_DeleteItem.html">DeleteItem</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DeleteItem#DeleteItem_sub"></div></li><li><a href="DeleteSet.html">DeleteSet</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DeleteSet_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="DeleteSet.html#clients">clients</a></li></ul></div></li><li><a href="DSDecoderV1_DSDecoderV1.html">DSDecoderV1</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DSDecoderV1#DSDecoderV1_sub"></div></li><li><a href="DSDecoderV2_DSDecoderV2.html">DSDecoderV2</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="DSDecoderV2#DSDecoderV2_sub"></div></li><li><a href="ID_ID.html">ID</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ID#ID_sub"></div></li><li><a href="Item.html">Item</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Item_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Item.html#content">content</a></li><li><a href="Item.html#deleted">deleted</a></li><li><a href="Item.html#info">info</a></li><li><a href="Item.html#keep">keep</a></li><li><a href="Item.html#lastId">lastId</a></li><li><a href="Item.html#left">left</a></li><li><a href="Item.html#marker">marker</a></li><li><a href="Item.html#next">next</a></li><li><a href="Item.html#origin">origin</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parent">parent</a></li><li><a href="Item.html#parentSub">parentSub</a></li><li><a href="Item.html#prev">prev</a></li><li><a href="Item.html#redone">redone</a></li><li><a href="Item.html#right">right</a></li><li><a href="Item.html#rightOrigin">rightOrigin</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Item.html#delete">delete</a></li><li><a href="Item.html#gc">gc</a></li><li><a href="Item.html#getMissing">getMissing</a></li><li><a href="Item.html#integrate">integrate</a></li><li><a href="Item.html#mergeWith">mergeWith</a></li><li><a href="Item.html#write">write</a></li></ul></div></li><li><a href="module-Y.Doc.html">Doc</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:Y.Doc_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-Y.Doc.html#_item">_item</a></li><li><a href="module-Y.Doc.html#_transaction">_transaction</a></li><li><a href="module-Y.Doc.html#_transactionCleanups">_transactionCleanups</a></li><li><a href="module-Y.Doc.html#share">share</a></li><li><a href="module-Y.Doc.html#subdocs">subdocs</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-Y.Doc.html#destroy">destroy</a></li><li><a href="module-Y.Doc.html#get">get</a></li><li><a href="module-Y.Doc.html#getArray">getArray</a></li><li><a href="module-Y.Doc.html#getMap">getMap</a></li><li><a href="module-Y.Doc.html#getText">getText</a></li><li><a href="module-Y.Doc.html#getXmlFragment">getXmlFragment</a></li><li><a href="module-Y.Doc.html#load">load</a></li><li><a href="module-Y.Doc.html#off">off</a></li><li><a href="module-Y.Doc.html#on">on</a></li><li><a href="module-Y.Doc.html#toJSON">toJSON</a></li><li><a href="module-Y.Doc.html#transact">transact</a></li></ul></div></li><li><a href="module-YArray.YArray.html">YArray</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray.YArray_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YArray.YArray.html#_prelimContent">_prelimContent</a></li><li><a href="module-YArray.YArray.html#_searchMarker">_searchMarker</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YArray.YArray.html#.from">from</a></li><li><a href="module-YArray.YArray.html#_callObserver">_callObserver</a></li><li><a href="module-YArray.YArray.html#_integrate">_integrate</a></li><li><a href="module-YArray.YArray.html#_write">_write</a></li><li><a href="module-YArray.YArray.html#clone">clone</a></li><li><a href="module-YArray.YArray.html#delete">delete</a></li><li><a href="module-YArray.YArray.html#forEach">forEach</a></li><li><a href="module-YArray.YArray.html#get">get</a></li><li><a href="module-YArray.YArray.html#insert">insert</a></li><li><a href="module-YArray.YArray.html#map">map</a></li><li><a href="module-YArray.YArray.html#push">push</a></li><li><a href="module-YArray.YArray.html#slice">slice</a></li><li><a href="module-YArray.YArray.html#Symbol.iterator">Symbol.iterator</a></li><li><a href="module-YArray.YArray.html#toArray">toArray</a></li><li><a href="module-YArray.YArray.html#toJSON">toJSON</a></li><li><a href="module-YArray.YArray.html#unshift">unshift</a></li></ul></div></li><li><a href="module-YArray.YArrayEvent.html">YArrayEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YArray.YArrayEvent_sub"></div></li><li><a href="module-YMap.YMap.html">YMap</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap.YMap_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YMap.YMap.html#size">size</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YMap.YMap.html#_callObserver">_callObserver</a></li><li><a href="module-YMap.YMap.html#_integrate">_integrate</a></li><li><a href="module-YMap.YMap.html#_write">_write</a></li><li><a href="module-YMap.YMap.html#clone">clone</a></li><li><a href="module-YMap.YMap.html#delete">delete</a></li><li><a href="module-YMap.YMap.html#entries">entries</a></li><li><a href="module-YMap.YMap.html#forEach">forEach</a></li><li><a href="module-YMap.YMap.html#get">get</a></li><li><a href="module-YMap.YMap.html#has">has</a></li><li><a href="module-YMap.YMap.html#keys">keys</a></li><li><a href="module-YMap.YMap.html#set">set</a></li><li><a href="module-YMap.YMap.html#Symbol.iterator">Symbol.iterator</a></li><li><a href="module-YMap.YMap.html#toJSON">toJSON</a></li><li><a href="module-YMap.YMap.html#values">values</a></li></ul></div></li><li><a href="module-YMap.YMapEvent.html">YMapEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YMap.YMapEvent_sub"></div></li><li><a href="module-YText.ItemTextListPosition.html">ItemTextListPosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.ItemTextListPosition_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.ItemTextListPosition.html#forward">forward</a></li></ul></div></li><li><a href="module-YText.YText.html">YText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.YText_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.YText.html#_pending">_pending</a></li><li><a href="module-YText.YText.html#_searchMarker">_searchMarker</a></li><li><a href="module-YText.YText.html#doc">doc</a></li><li><a href="module-YText.YText.html#length">length</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YText.YText.html#_callObserver">_callObserver</a></li><li><a href="module-YText.YText.html#_integrate">_integrate</a></li><li><a href="module-YText.YText.html#_write">_write</a></li><li><a href="module-YText.YText.html#applyDelta">applyDelta</a></li><li><a href="module-YText.YText.html#clone">clone</a></li><li><a href="module-YText.YText.html#delete">delete</a></li><li><a href="module-YText.YText.html#format">format</a></li><li><a href="module-YText.YText.html#getAttribute">getAttribute</a></li><li><a href="module-YText.YText.html#getAttributes">getAttributes</a></li><li><a href="module-YText.YText.html#insert">insert</a></li><li><a href="module-YText.YText.html#insertEmbed">insertEmbed</a></li><li><a href="module-YText.YText.html#removeAttribute">removeAttribute</a></li><li><a href="module-YText.YText.html#setAttribute">setAttribute</a></li><li><a href="module-YText.YText.html#toDelta">toDelta</a></li><li><a href="module-YText.YText.html#toJSON">toJSON</a></li><li><a href="module-YText.YText.html#toString">toString</a></li></ul></div></li><li><a href="module-YText.YTextEvent.html">YTextEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YText.YTextEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YText.YTextEvent.html#_delta">_delta</a></li><li><a href="module-YText.YTextEvent.html#_delta">_delta</a></li><li><a href="module-YText.YTextEvent.html#delta">delta</a></li><li><a href="module-YText.YTextEvent.html#keysChanged">keysChanged</a></li></ul></div></li><li><a href="module-YXml.YXmlFragment.html">YXmlFragment</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml.YXmlFragment_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YXml.YXmlFragment.html#_prelimContent">_prelimContent</a></li><li><a href="module-YXml.YXmlFragment.html#_prelimContent">_prelimContent</a></li><li><a href="module-YXml.YXmlFragment.html#_prelimContent">_prelimContent</a></li><li><a href="module-YXml.YXmlFragment.html#firstChild">firstChild</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YXml.YXmlFragment.html#_callObserver">_callObserver</a></li><li><a href="module-YXml.YXmlFragment.html#_integrate">_integrate</a></li><li><a href="module-YXml.YXmlFragment.html#_write">_write</a></li><li><a href="module-YXml.YXmlFragment.html#clone">clone</a></li><li><a href="module-YXml.YXmlFragment.html#createTreeWalker">createTreeWalker</a></li><li><a href="module-YXml.YXmlFragment.html#delete">delete</a></li><li><a href="module-YXml.YXmlFragment.html#get">get</a></li><li><a href="module-YXml.YXmlFragment.html#insert">insert</a></li><li><a href="module-YXml.YXmlFragment.html#insertAfter">insertAfter</a></li><li><a href="module-YXml.YXmlFragment.html#push">push</a></li><li><a href="module-YXml.YXmlFragment.html#querySelector">querySelector</a></li><li><a href="module-YXml.YXmlFragment.html#querySelectorAll">querySelectorAll</a></li><li><a href="module-YXml.YXmlFragment.html#slice">slice</a></li><li><a href="module-YXml.YXmlFragment.html#toArray">toArray</a></li><li><a href="module-YXml.YXmlFragment.html#toDOM">toDOM</a></li><li><a href="module-YXml.YXmlFragment.html#toJSON">toJSON</a></li><li><a href="module-YXml.YXmlFragment.html#toString">toString</a></li><li><a href="module-YXml.YXmlFragment.html#unshift">unshift</a></li></ul></div></li><li><a href="module-YXml.YXmlTreeWalker.html">YXmlTreeWalker</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:YXml.YXmlTreeWalker_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-YXml.YXmlTreeWalker.html#_currentNode">_currentNode</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="module-YXml.YXmlTreeWalker.html#next">next</a></li></ul></div></li><li><a href="PermanentUserData_PermanentUserData.html">PermanentUserData</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="PermanentUserData#PermanentUserData_sub"></div></li><li><a href="RelativePosition.html">RelativePosition</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="RelativePosition_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="RelativePosition.html#assoc">assoc</a></li><li><a href="RelativePosition.html#item">item</a></li><li><a href="RelativePosition.html#tname">tname</a></li><li><a href="RelativePosition.html#type">type</a></li></ul></div></li><li><a href="Snapshot_Snapshot.html">Snapshot</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Snapshot#Snapshot_sub"></div></li><li><a href="StackItem.html">StackItem</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="StackItem_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="StackItem.html#meta">meta</a></li></ul></div></li><li><a href="Transaction.html">Transaction</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Transaction_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Transaction.html#_mergeStructs">_mergeStructs</a></li><li><a href="Transaction.html#afterState">afterState</a></li><li><a href="Transaction.html#beforeState">beforeState</a></li><li><a href="Transaction.html#changed">changed</a></li><li><a href="Transaction.html#changedParentTypes">changedParentTypes</a></li><li><a href="Transaction.html#deleteSet">deleteSet</a></li><li><a href="Transaction.html#doc">doc</a></li><li><a href="Transaction.html#local">local</a></li><li><a href="Transaction.html#meta">meta</a></li><li><a href="Transaction.html#origin">origin</a></li><li><a href="Transaction.html#subdocsAdded">subdocsAdded</a></li><li><a href="Transaction.html#subdocsLoaded">subdocsLoaded</a></li><li><a href="Transaction.html#subdocsRemoved">subdocsRemoved</a></li></ul></div></li><li><a href="UndoManager.html">UndoManager</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UndoManager_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UndoManager.html#redoStack">redoStack</a></li><li><a href="UndoManager.html#undoing">undoing</a></li><li><a href="UndoManager.html#undoStack">undoStack</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UndoManager.html#redo">redo</a></li><li><a href="UndoManager.html#stopCapturing">stopCapturing</a></li><li><a href="UndoManager.html#undo">undo</a></li></ul></div></li><li><a href="UpdateDecoderV2_UpdateDecoderV2.html">UpdateDecoderV2</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UpdateDecoderV2#UpdateDecoderV2_sub"></div></li><li><a href="YEvent.html">YEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YEvent.html#_changes">_changes</a></li><li><a href="YEvent.html#changes">changes</a></li><li><a href="YEvent.html#currentTarget">currentTarget</a></li><li><a href="YEvent.html#path">path</a></li><li><a href="YEvent.html#target">target</a></li><li><a href="YEvent.html#transaction">transaction</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YEvent.html#adds">adds</a></li><li><a href="YEvent.html#deletes">deletes</a></li></ul></div></li><li><a href="YXmlElement.html">YXmlElement</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlElement_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlElement.html#_prelimAttrs">_prelimAttrs</a></li><li><a href="YXmlElement.html#_prelimAttrs">_prelimAttrs</a></li><li><a href="YXmlElement.html#nextSibling">nextSibling</a></li><li><a href="YXmlElement.html#prevSibling">prevSibling</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlElement.html#_copy">_copy</a></li><li><a href="YXmlElement.html#_integrate">_integrate</a></li><li><a href="YXmlElement.html#_write">_write</a></li><li><a href="YXmlElement.html#clone">clone</a></li><li><a href="YXmlElement.html#getAttribute">getAttribute</a></li><li><a href="YXmlElement.html#getAttributes">getAttributes</a></li><li><a href="YXmlElement.html#removeAttribute">removeAttribute</a></li><li><a href="YXmlElement.html#setAttribute">setAttribute</a></li><li><a href="YXmlElement.html#toDOM">toDOM</a></li><li><a href="YXmlElement.html#toString">toString</a></li></ul></div></li><li><a href="YXmlEvent.html">YXmlEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlEvent.html#attributesChanged">attributesChanged</a></li></ul></div></li><li><a href="YXmlHook.html">YXmlHook</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlHook_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlHook.html#hookName">hookName</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlHook.html#_copy">_copy</a></li><li><a href="YXmlHook.html#_write">_write</a></li><li><a href="YXmlHook.html#clone">clone</a></li><li><a href="YXmlHook.html#toDOM">toDOM</a></li></ul></div></li><li><a href="YXmlText.html">YXmlText</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="YXmlText_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="YXmlText.html#nextSibling">nextSibling</a></li><li><a href="YXmlText.html#prevSibling">prevSibling</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="YXmlText.html#_write">_write</a></li><li><a href="YXmlText.html#clone">clone</a></li><li><a href="YXmlText.html#toDOM">toDOM</a></li><li><a href="YXmlText.html#toJSON">toJSON</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#addChangedTypeToTransaction">addChangedTypeToTransaction</a></li><li><a href="global.html#callTypeObservers">callTypeObservers</a></li><li><a href="global.html#cleanupTransactions">cleanupTransactions</a></li><li><a href="global.html#compareIDs">compareIDs</a></li><li><a href="global.html#compareRelativePositions">compareRelativePositions</a></li><li><a href="global.html#contentRefs">contentRefs</a></li><li><a href="global.html#createAbsolutePosition">createAbsolutePosition</a></li><li><a href="global.html#createAbsolutePositionFromRelativePosition">createAbsolutePositionFromRelativePosition</a></li><li><a href="global.html#createDocFromSnapshot">createDocFromSnapshot</a></li><li><a href="global.html#createRelativePosition">createRelativePosition</a></li><li><a href="global.html#createRelativePositionFromJSON">createRelativePositionFromJSON</a></li><li><a href="global.html#createRelativePositionFromTypeIndex">createRelativePositionFromTypeIndex</a></li><li><a href="global.html#createSnapshot">createSnapshot</a></li><li><a href="global.html#decodeRelativePosition">decodeRelativePosition</a></li><li><a href="global.html#decodeSnapshot">decodeSnapshot</a></li><li><a href="global.html#decodeSnapshotV2">decodeSnapshotV2</a></li><li><a href="global.html#encodeRelativePosition">encodeRelativePosition</a></li><li><a href="global.html#encodeSnapshot">encodeSnapshot</a></li><li><a href="global.html#encodeSnapshotV2">encodeSnapshotV2</a></li><li><a href="global.html#equalSnapshots">equalSnapshots</a></li><li><a href="global.html#findIndexCleanStart">findIndexCleanStart</a></li><li><a href="global.html#findMarker">findMarker</a></li><li><a href="global.html#followRedone">followRedone</a></li><li><a href="global.html#getState">getState</a></li><li><a href="global.html#getStateVector">getStateVector</a></li><li><a href="global.html#getTypeChildren">getTypeChildren</a></li><li><a href="global.html#globalSearchMarkerTimestamp">globalSearchMarkerTimestamp</a></li><li><a href="global.html#isVisible">isVisible</a></li><li><a href="global.html#iterateDeletedStructs">iterateDeletedStructs</a></li><li><a href="global.html#iterateStructs">iterateStructs</a></li><li><a href="global.html#keepItem">keepItem</a></li><li><a href="global.html#logType">logType</a></li><li><a href="global.html#markPosition">markPosition</a></li><li><a href="global.html#mergeDeleteSets">mergeDeleteSets</a></li><li><a href="global.html#overwriteMarker">overwriteMarker</a></li><li><a href="global.html#popStackItem">popStackItem</a></li><li><a href="global.html#readContentAny">readContentAny</a></li><li><a href="global.html#readContentBinary">readContentBinary</a></li><li><a href="global.html#readContentFormat">readContentFormat</a></li><li><a href="global.html#readItemContent">readItemContent</a></li><li><a href="global.html#readRelativePosition">readRelativePosition</a></li><li><a href="global.html#readYXmlElement">readYXmlElement</a></li><li><a href="global.html#refreshMarkerTimestamp">refreshMarkerTimestamp</a></li><li><a href="global.html#snapshot">snapshot</a></li><li><a href="global.html#splitSnapshotAffectedStructs">splitSnapshotAffectedStructs</a></li><li><a href="global.html#transact">transact</a></li><li><a href="global.html#tryGc">tryGc</a></li><li><a href="global.html#tryGcDeleteSet">tryGcDeleteSet</a></li><li><a href="global.html#tryMergeDeleteSet">tryMergeDeleteSet</a></li><li><a href="global.html#tryToMergeWithLeft">tryToMergeWithLeft</a></li><li class="hidden"><a href="global.html#UndoManagerOptions">UndoManagerOptions</a></li><li><a href="global.html#updateMarkerChanges">updateMarkerChanges</a></li><li><a href="global.html#writeRelativePosition">writeRelativePosition</a></li><li><a href="global.html#writeUpdateMessageFromTransaction">writeUpdateMessageFromTransaction</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import {
  removeEventHandlerListener,
  callEventHandlerListeners,
  addEventHandlerListener,
  createEventHandler,
  getState,
  isVisible,
  ContentType,
  createID,
  ContentAny,
  ContentBinary,
  getItemCleanStart,
  ContentDoc, YText, YArray, AbstractUpdateEncoder, Doc, Snapshot, Transaction, EventHandler, YEvent, Item, // eslint-disable-line
} from '../internals.js'

import * as map from 'lib0/map.js'
import * as iterator from 'lib0/iterator.js'
import * as error from 'lib0/error.js'
import * as math from 'lib0/math.js'

const maxSearchMarker = 80

/**
 * A unique timestamp that identifies each marker.
 *
 * Time is relative,.. this is more like an ever-increasing clock.
 *
 * @type {number}
 */
let globalSearchMarkerTimestamp = 0

export class ArraySearchMarker {
  /**
   * @param {Item} p
   * @param {number} index
   */
  constructor (p, index) {
    p.marker = true
    this.p = p
    this.index = index
    this.timestamp = globalSearchMarkerTimestamp++
  }
}

/**
 * @param {ArraySearchMarker} marker
 */
const refreshMarkerTimestamp = marker => { marker.timestamp = globalSearchMarkerTimestamp++ }

/**
 * This is rather complex so this function is the only thing that should overwrite a marker
 *
 * @param {ArraySearchMarker} marker
 * @param {Item} p
 * @param {number} index
 */
const overwriteMarker = (marker, p, index) => {
  marker.p.marker = false
  marker.p = p
  p.marker = true
  marker.index = index
  marker.timestamp = globalSearchMarkerTimestamp++
}

/**
 * @param {Array&lt;ArraySearchMarker>} searchMarker
 * @param {Item} p
 * @param {number} index
 */
const markPosition = (searchMarker, p, index) => {
  if (searchMarker.length >= maxSearchMarker) {
    // override oldest marker (we don't want to create more objects)
    const marker = searchMarker.reduce((a, b) => a.timestamp &lt; b.timestamp ? a : b)
    overwriteMarker(marker, p, index)
    return marker
  } else {
    // create new marker
    const pm = new ArraySearchMarker(p, index)
    searchMarker.push(pm)
    return pm
  }
}

/**
 * Search marker help us to find positions in the associative array faster.
 *
 * They speed up the process of finding a position without much bookkeeping.
 *
 * A maximum of `maxSearchMarker` objects are created.
 *
 * This function always returns a refreshed marker (updated timestamp)
 *
 * @param {AbstractType&lt;any>} yarray
 * @param {number} index
 */
export const findMarker = (yarray, index) => {
  if (yarray._start === null || index === 0 || yarray._searchMarker === null) {
    return null
  }
  const marker = yarray._searchMarker.length === 0 ? null : yarray._searchMarker.reduce((a, b) => math.abs(index - a.index) &lt; math.abs(index - b.index) ? a : b)
  let p = yarray._start
  let pindex = 0
  if (marker !== null) {
    p = marker.p
    pindex = marker.index
    refreshMarkerTimestamp(marker) // we used it, we might need to use it again
  }
  // iterate to right if possible
  while (p.right !== null &amp;&amp; pindex &lt; index) {
    if (!p.deleted &amp;&amp; p.countable) {
      if (index &lt; pindex + p.length) {
        break
      }
      pindex += p.length
    }
    p = p.right
  }
  // iterate to left if necessary (might be that pindex > index)
  while (p.left !== null &amp;&amp; pindex > index) {
    p = p.left
    if (!p.deleted &amp;&amp; p.countable) {
      pindex -= p.length
    }
  }
  // we want to make sure that p can't be merged with left, because that would screw up everything
  // in that cas just return what we have (it is most likely the best marker anyway)
  // iterate to left until p can't be merged with left
  while (p.left !== null &amp;&amp; p.left.id.client === p.id.client &amp;&amp; p.left.id.clock + p.left.length === p.id.clock) {
    p = p.left
    if (!p.deleted &amp;&amp; p.countable) {
      pindex -= p.length
    }
  }

  // @todo remove!
  // assure position
  // {
  //   let start = yarray._start
  //   let pos = 0
  //   while (start !== p) {
  //     if (!start.deleted &amp;&amp; start.countable) {
  //       pos += start.length
  //     }
  //     start = /** @type {Item} */ (start.right)
  //   }
  //   if (pos !== pindex) {
  //     debugger
  //     throw new Error('Gotcha position fail!')
  //   }
  // }
  // if (marker) {
  //   if (window.lengthes == null) {
  //     window.lengthes = []
  //     window.getLengthes = () => window.lengthes.sort((a, b) => a - b)
  //   }
  //   window.lengthes.push(marker.index - pindex)
  //   console.log('distance', marker.index - pindex, 'len', p &amp;&amp; p.parent.length)
  // }
  if (marker !== null &amp;&amp; math.abs(marker.index - pindex) &lt; /** @type {YText|YArray&lt;any>} */ (p.parent).length / maxSearchMarker) {
    // adjust existing marker
    overwriteMarker(marker, p, pindex)
    return marker
  } else {
    // create new marker
    return markPosition(yarray._searchMarker, p, pindex)
  }
}

/**
 * Update markers when a change happened.
 *
 * This should be called before doing a deletion!
 *
 * @param {Array&lt;ArraySearchMarker>} searchMarker
 * @param {number} index
 * @param {number} len If insertion, len is positive. If deletion, len is negative.
 */
export const updateMarkerChanges = (searchMarker, index, len) => {
  for (let i = searchMarker.length - 1; i >= 0; i--) {
    const m = searchMarker[i]
    if (len > 0) {
      /**
       * @type {Item|null}
       */
      let p = m.p
      p.marker = false
      // Ideally we just want to do a simple position comparison, but this will only work if
      // search markers don't point to deleted items for formats.
      // Iterate marker to prev undeleted countable position so we know what to do when updating a position
      while (p &amp;&amp; (p.deleted || !p.countable)) {
        p = p.left
        if (p &amp;&amp; !p.deleted &amp;&amp; p.countable) {
          // adjust position. the loop should break now
          m.index -= p.length
        }
      }
      if (p === null || p.marker === true) {
        // remove search marker if updated position is null or if position is already marked
        searchMarker.splice(i, 1)
        continue
      }
      m.p = p
      p.marker = true
    }
    if (index &lt; m.index || (len > 0 &amp;&amp; index === m.index)) { // a simple index &lt;= m.index check would actually suffice
      m.index = math.max(index, m.index + len)
    }
  }
}

/**
 * Accumulate all (list) children of a type and return them as an Array.
 *
 * @param {AbstractType&lt;any>} t
 * @return {Array&lt;Item>}
 */
export const getTypeChildren = t => {
  let s = t._start
  const arr = []
  while (s) {
    arr.push(s)
    s = s.right
  }
  return arr
}

/**
 * Call event listeners with an event. This will also add an event to all
 * parents (for `.observeDeep` handlers).
 *
 * @template EventType
 * @param {AbstractType&lt;EventType>} type
 * @param {Transaction} transaction
 * @param {EventType} event
 */
export const callTypeObservers = (type, transaction, event) => {
  const changedType = type
  const changedParentTypes = transaction.changedParentTypes
  while (true) {
    // @ts-ignore
    map.setIfUndefined(changedParentTypes, type, () => []).push(event)
    if (type._item === null) {
      break
    }
    type = /** @type {AbstractType&lt;any>} */ (type._item.parent)
  }
  callEventHandlerListeners(changedType._eH, event, transaction)
}

/**
 * @template EventType
 * Abstract Yjs Type class
 */
export class AbstractType {
  constructor () {
    /**
     * @type {Item|null}
     */
    this._item = null
    /**
     * @type {Map&lt;string,Item>}
     */
    this._map = new Map()
    /**
     * @type {Item|null}
     */
    this._start = null
    /**
     * @type {Doc|null}
     */
    this.doc = null
    this._length = 0
    /**
     * Event handlers
     * @type {EventHandler&lt;EventType,Transaction>}
     */
    this._eH = createEventHandler()
    /**
     * Deep event handlers
     * @type {EventHandler&lt;Array&lt;YEvent>,Transaction>}
     */
    this._dEH = createEventHandler()
    /**
     * @type {null | Array&lt;ArraySearchMarker>}
     */
    this._searchMarker = null
  }

  /**
   * @return {AbstractType&lt;any>|null}
   */
  get parent () {
    return this._item ? /** @type {AbstractType&lt;any>} */ (this._item.parent) : null
  }

  /**
   * Integrate this type into the Yjs instance.
   *
   * * Save this struct in the os
   * * This type is sent to other client
   * * Observer functions are fired
   *
   * @param {Doc} y The Yjs instance
   * @param {Item|null} item
   */
  _integrate (y, item) {
    this.doc = y
    this._item = item
  }

  /**
   * @return {AbstractType&lt;EventType>}
   */
  _copy () {
    throw error.methodUnimplemented()
  }

  /**
   * @return {AbstractType&lt;EventType>}
   */
  clone () {
    throw error.methodUnimplemented()
  }

  /**
   * @param {AbstractUpdateEncoder} encoder
   */
  _write (encoder) { }

  /**
   * The first non-deleted item
   */
  get _first () {
    let n = this._start
    while (n !== null &amp;&amp; n.deleted) {
      n = n.right
    }
    return n
  }

  /**
   * Creates YEvent and calls all type observers.
   * Must be implemented by each type.
   *
   * @param {Transaction} transaction
   * @param {Set&lt;null|string>} parentSubs Keys changed on this type. `null` if list was modified.
   */
  _callObserver (transaction, parentSubs) {
    if (!transaction.local &amp;&amp; this._searchMarker) {
      this._searchMarker.length = 0
    }
  }

  /**
   * Observe all events that are created on this type.
   *
   * @param {function(EventType, Transaction):void} f Observer function
   */
  observe (f) {
    addEventHandlerListener(this._eH, f)
  }

  /**
   * Observe all events that are created by this type and its children.
   *
   * @param {function(Array&lt;YEvent>,Transaction):void} f Observer function
   */
  observeDeep (f) {
    addEventHandlerListener(this._dEH, f)
  }

  /**
   * Unregister an observer function.
   *
   * @param {function(EventType,Transaction):void} f Observer function
   */
  unobserve (f) {
    removeEventHandlerListener(this._eH, f)
  }

  /**
   * Unregister an observer function.
   *
   * @param {function(Array&lt;YEvent>,Transaction):void} f Observer function
   */
  unobserveDeep (f) {
    removeEventHandlerListener(this._dEH, f)
  }

  /**
   * @abstract
   * @return {any}
   */
  toJSON () {}
}

/**
 * @param {AbstractType&lt;any>} type
 * @param {number} start
 * @param {number} end
 * @return {Array&lt;any>}
 *
 * @private
 * @function
 */
export const typeListSlice = (type, start, end) => {
  if (start &lt; 0) {
    start = type._length + start
  }
  if (end &lt; 0) {
    end = type._length + end
  }
  let len = end - start
  const cs = []
  let n = type._start
  while (n !== null &amp;&amp; len > 0) {
    if (n.countable &amp;&amp; !n.deleted) {
      const c = n.content.getContent()
      if (c.length &lt;= start) {
        start -= c.length
      } else {
        for (let i = start; i &lt; c.length &amp;&amp; len > 0; i++) {
          cs.push(c[i])
          len--
        }
        start = 0
      }
    }
    n = n.right
  }
  return cs
}

/**
 * @param {AbstractType&lt;any>} type
 * @return {Array&lt;any>}
 *
 * @private
 * @function
 */
export const typeListToArray = type => {
  const cs = []
  let n = type._start
  while (n !== null) {
    if (n.countable &amp;&amp; !n.deleted) {
      const c = n.content.getContent()
      for (let i = 0; i &lt; c.length; i++) {
        cs.push(c[i])
      }
    }
    n = n.right
  }
  return cs
}

/**
 * @param {AbstractType&lt;any>} type
 * @param {Snapshot} snapshot
 * @return {Array&lt;any>}
 *
 * @private
 * @function
 */
export const typeListToArraySnapshot = (type, snapshot) => {
  const cs = []
  let n = type._start
  while (n !== null) {
    if (n.countable &amp;&amp; isVisible(n, snapshot)) {
      const c = n.content.getContent()
      for (let i = 0; i &lt; c.length; i++) {
        cs.push(c[i])
      }
    }
    n = n.right
  }
  return cs
}

/**
 * Executes a provided function on once on overy element of this YArray.
 *
 * @param {AbstractType&lt;any>} type
 * @param {function(any,number,any):void} f A function to execute on every element of this YArray.
 *
 * @private
 * @function
 */
export const typeListForEach = (type, f) => {
  let index = 0
  let n = type._start
  while (n !== null) {
    if (n.countable &amp;&amp; !n.deleted) {
      const c = n.content.getContent()
      for (let i = 0; i &lt; c.length; i++) {
        f(c[i], index++, type)
      }
    }
    n = n.right
  }
}

/**
 * @template C,R
 * @param {AbstractType&lt;any>} type
 * @param {function(C,number,AbstractType&lt;any>):R} f
 * @return {Array&lt;R>}
 *
 * @private
 * @function
 */
export const typeListMap = (type, f) => {
  /**
   * @type {Array&lt;any>}
   */
  const result = []
  typeListForEach(type, (c, i) => {
    result.push(f(c, i, type))
  })
  return result
}

/**
 * @param {AbstractType&lt;any>} type
 * @return {IterableIterator&lt;any>}
 *
 * @private
 * @function
 */
export const typeListCreateIterator = type => {
  let n = type._start
  /**
   * @type {Array&lt;any>|null}
   */
  let currentContent = null
  let currentContentIndex = 0
  return {
    [Symbol.iterator] () {
      return this
    },
    next: () => {
      // find some content
      if (currentContent === null) {
        while (n !== null &amp;&amp; n.deleted) {
          n = n.right
        }
        // check if we reached the end, no need to check currentContent, because it does not exist
        if (n === null) {
          return {
            done: true,
            value: undefined
          }
        }
        // we found n, so we can set currentContent
        currentContent = n.content.getContent()
        currentContentIndex = 0
        n = n.right // we used the content of n, now iterate to next
      }
      const value = currentContent[currentContentIndex++]
      // check if we need to empty currentContent
      if (currentContent.length &lt;= currentContentIndex) {
        currentContent = null
      }
      return {
        done: false,
        value
      }
    }
  }
}

/**
 * Executes a provided function on once on overy element of this YArray.
 * Operates on a snapshotted state of the document.
 *
 * @param {AbstractType&lt;any>} type
 * @param {function(any,number,AbstractType&lt;any>):void} f A function to execute on every element of this YArray.
 * @param {Snapshot} snapshot
 *
 * @private
 * @function
 */
export const typeListForEachSnapshot = (type, f, snapshot) => {
  let index = 0
  let n = type._start
  while (n !== null) {
    if (n.countable &amp;&amp; isVisible(n, snapshot)) {
      const c = n.content.getContent()
      for (let i = 0; i &lt; c.length; i++) {
        f(c[i], index++, type)
      }
    }
    n = n.right
  }
}

/**
 * @param {AbstractType&lt;any>} type
 * @param {number} index
 * @return {any}
 *
 * @private
 * @function
 */
export const typeListGet = (type, index) => {
  const marker = findMarker(type, index)
  let n = type._start
  if (marker !== null) {
    n = marker.p
    index -= marker.index
  }
  for (; n !== null; n = n.right) {
    if (!n.deleted &amp;&amp; n.countable) {
      if (index &lt; n.length) {
        return n.content.getContent()[index]
      }
      index -= n.length
    }
  }
}

/**
 * @param {Transaction} transaction
 * @param {AbstractType&lt;any>} parent
 * @param {Item?} referenceItem
 * @param {Array&lt;Object&lt;string,any>|Array&lt;any>|boolean|number|string|Uint8Array>} content
 *
 * @private
 * @function
 */
export const typeListInsertGenericsAfter = (transaction, parent, referenceItem, content) => {
  let left = referenceItem
  const doc = transaction.doc
  const ownClientId = doc.clientID
  const store = doc.store
  const right = referenceItem === null ? parent._start : referenceItem.right
  /**
   * @type {Array&lt;Object|Array&lt;any>|number>}
   */
  let jsonContent = []
  const packJsonContent = () => {
    if (jsonContent.length > 0) {
      left = new Item(createID(ownClientId, getState(store, ownClientId)), left, left &amp;&amp; left.lastId, right, right &amp;&amp; right.id, parent, null, new ContentAny(jsonContent))
      left.integrate(transaction, 0)
      jsonContent = []
    }
  }
  content.forEach(c => {
    switch (c.constructor) {
      case Number:
      case Object:
      case Boolean:
      case Array:
      case String:
        jsonContent.push(c)
        break
      default:
        packJsonContent()
        switch (c.constructor) {
          case Uint8Array:
          case ArrayBuffer:
            left = new Item(createID(ownClientId, getState(store, ownClientId)), left, left &amp;&amp; left.lastId, right, right &amp;&amp; right.id, parent, null, new ContentBinary(new Uint8Array(/** @type {Uint8Array} */ (c))))
            left.integrate(transaction, 0)
            break
          case Doc:
            left = new Item(createID(ownClientId, getState(store, ownClientId)), left, left &amp;&amp; left.lastId, right, right &amp;&amp; right.id, parent, null, new ContentDoc(/** @type {Doc} */ (c)))
            left.integrate(transaction, 0)
            break
          default:
            if (c instanceof AbstractType) {
              left = new Item(createID(ownClientId, getState(store, ownClientId)), left, left &amp;&amp; left.lastId, right, right &amp;&amp; right.id, parent, null, new ContentType(c))
              left.integrate(transaction, 0)
            } else {
              throw new Error('Unexpected content type in insert operation')
            }
        }
    }
  })
  packJsonContent()
}

/**
 * @param {Transaction} transaction
 * @param {AbstractType&lt;any>} parent
 * @param {number} index
 * @param {Array&lt;Object&lt;string,any>|Array&lt;any>|number|string|Uint8Array>} content
 *
 * @private
 * @function
 */
export const typeListInsertGenerics = (transaction, parent, index, content) => {
  if (index === 0) {
    if (parent._searchMarker) {
      updateMarkerChanges(parent._searchMarker, index, content.length)
    }
    return typeListInsertGenericsAfter(transaction, parent, null, content)
  }
  const startIndex = index
  const marker = findMarker(parent, index)
  let n = parent._start
  if (marker !== null) {
    n = marker.p
    index -= marker.index
    // we need to iterate one to the left so that the algorithm works
    if (index === 0) {
      // @todo refactor this as it actually doesn't consider formats
      n = n.prev // important! get the left undeleted item so that we can actually decrease index
      index += (n &amp;&amp; n.countable &amp;&amp; !n.deleted) ? n.length : 0
    }
  }
  for (; n !== null; n = n.right) {
    if (!n.deleted &amp;&amp; n.countable) {
      if (index &lt;= n.length) {
        if (index &lt; n.length) {
          // insert in-between
          getItemCleanStart(transaction, createID(n.id.client, n.id.clock + index))
        }
        break
      }
      index -= n.length
    }
  }
  if (parent._searchMarker) {
    updateMarkerChanges(parent._searchMarker, startIndex, content.length)
  }
  return typeListInsertGenericsAfter(transaction, parent, n, content)
}

/**
 * @param {Transaction} transaction
 * @param {AbstractType&lt;any>} parent
 * @param {number} index
 * @param {number} length
 *
 * @private
 * @function
 */
export const typeListDelete = (transaction, parent, index, length) => {
  if (length === 0) { return }
  const startIndex = index
  const startLength = length
  const marker = findMarker(parent, index)
  let n = parent._start
  if (marker !== null) {
    n = marker.p
    index -= marker.index
  }
  // compute the first item to be deleted
  for (; n !== null &amp;&amp; index > 0; n = n.right) {
    if (!n.deleted &amp;&amp; n.countable) {
      if (index &lt; n.length) {
        getItemCleanStart(transaction, createID(n.id.client, n.id.clock + index))
      }
      index -= n.length
    }
  }
  // delete all items until done
  while (length > 0 &amp;&amp; n !== null) {
    if (!n.deleted) {
      if (length &lt; n.length) {
        getItemCleanStart(transaction, createID(n.id.client, n.id.clock + length))
      }
      n.delete(transaction)
      length -= n.length
    }
    n = n.right
  }
  if (length > 0) {
    throw error.create('array length exceeded')
  }
  if (parent._searchMarker) {
    updateMarkerChanges(parent._searchMarker, startIndex, -startLength + length /* in case we remove the above exception */)
  }
}

/**
 * @param {Transaction} transaction
 * @param {AbstractType&lt;any>} parent
 * @param {string} key
 *
 * @private
 * @function
 */
export const typeMapDelete = (transaction, parent, key) => {
  const c = parent._map.get(key)
  if (c !== undefined) {
    c.delete(transaction)
  }
}

/**
 * @param {Transaction} transaction
 * @param {AbstractType&lt;any>} parent
 * @param {string} key
 * @param {Object|number|Array&lt;any>|string|Uint8Array|AbstractType&lt;any>} value
 *
 * @private
 * @function
 */
export const typeMapSet = (transaction, parent, key, value) => {
  const left = parent._map.get(key) || null
  const doc = transaction.doc
  const ownClientId = doc.clientID
  let content
  if (value == null) {
    content = new ContentAny([value])
  } else {
    switch (value.constructor) {
      case Number:
      case Object:
      case Boolean:
      case Array:
      case String:
        content = new ContentAny([value])
        break
      case Uint8Array:
        content = new ContentBinary(/** @type {Uint8Array} */ (value))
        break
      case Doc:
        content = new ContentDoc(/** @type {Doc} */ (value))
        break
      default:
        if (value instanceof AbstractType) {
          content = new ContentType(value)
        } else {
          throw new Error('Unexpected content type')
        }
    }
  }
  new Item(createID(ownClientId, getState(doc.store, ownClientId)), left, left &amp;&amp; left.lastId, null, null, parent, key, content).integrate(transaction, 0)
}

/**
 * @param {AbstractType&lt;any>} parent
 * @param {string} key
 * @return {Object&lt;string,any>|number|Array&lt;any>|string|Uint8Array|AbstractType&lt;any>|undefined}
 *
 * @private
 * @function
 */
export const typeMapGet = (parent, key) => {
  const val = parent._map.get(key)
  return val !== undefined &amp;&amp; !val.deleted ? val.content.getContent()[val.length - 1] : undefined
}

/**
 * @param {AbstractType&lt;any>} parent
 * @return {Object&lt;string,Object&lt;string,any>|number|Array&lt;any>|string|Uint8Array|AbstractType&lt;any>|undefined>}
 *
 * @private
 * @function
 */
export const typeMapGetAll = (parent) => {
  /**
   * @type {Object&lt;string,any>}
   */
  const res = {}
  parent._map.forEach((value, key) => {
    if (!value.deleted) {
      res[key] = value.content.getContent()[value.length - 1]
    }
  })
  return res
}

/**
 * @param {AbstractType&lt;any>} parent
 * @param {string} key
 * @return {boolean}
 *
 * @private
 * @function
 */
export const typeMapHas = (parent, key) => {
  const val = parent._map.get(key)
  return val !== undefined &amp;&amp; !val.deleted
}

/**
 * @param {AbstractType&lt;any>} parent
 * @param {string} key
 * @param {Snapshot} snapshot
 * @return {Object&lt;string,any>|number|Array&lt;any>|string|Uint8Array|AbstractType&lt;any>|undefined}
 *
 * @private
 * @function
 */
export const typeMapGetSnapshot = (parent, key, snapshot) => {
  let v = parent._map.get(key) || null
  while (v !== null &amp;&amp; (!snapshot.sv.has(v.id.client) || v.id.clock >= (snapshot.sv.get(v.id.client) || 0))) {
    v = v.left
  }
  return v !== null &amp;&amp; isVisible(v, snapshot) ? v.content.getContent()[v.length - 1] : undefined
}

/**
 * @param {Map&lt;string,Item>} map
 * @return {IterableIterator&lt;Array&lt;any>>}
 *
 * @private
 * @function
 */
export const createMapIterator = map => iterator.iteratorFilter(map.entries(), /** @param {any} entry */ entry => !entry[1].deleted)
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://yjs.dev/images/logo/yjs-512x512.png" style="width: 162px; height: 162px">
    <div class="footer-text">Shared Editing</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
